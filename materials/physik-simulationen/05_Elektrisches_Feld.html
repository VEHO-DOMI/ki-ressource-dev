<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elektrisches Feld - Feldlinien</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 10px;
            color: #fff;
        }
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 12px;
            height: calc(100vh - 80px);
            min-height: 500px;
        }
        @media (max-width: 900px) {
            .main-layout {
                grid-template-columns: 1fr;
                height: auto;
            }
        }
        h1 { font-size: 1.4em; color: #ff7043; margin-bottom: 6px; text-align: center; }
        .subtitle { font-size: 0.75em; text-align: center; color: #90a4ae; margin-bottom: 10px; }
        .canvas-container {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        canvas { display: block; border-radius: 8px; flex: 1; background: #0a0a15; cursor: crosshair; }
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            padding-right: 6px;
        }
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255,112,67,0.3);
            border-radius: 3px;
        }
        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 10px;
        }
        .panel h3 { font-size: 0.8em; color: #ff7043; margin-bottom: 8px; }
        .charge-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }
        .charge-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
        }
        .charge-btn.positive {
            background: linear-gradient(135deg, #e53935, #c62828);
            color: white;
        }
        .charge-btn.negative {
            background: linear-gradient(135deg, #1e88e5, #1565c0);
            color: white;
        }
        .charge-btn:hover { transform: scale(1.05); }
        .charge-btn.active { box-shadow: 0 0 12px rgba(255,255,255,0.5); }
        .btn {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }
        .btn-clear { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-clear:hover { background: rgba(255,255,255,0.2); }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .checkbox-group input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #ff7043;
        }
        .checkbox-group label { font-size: 0.75em; color: #b0bec5; }
        .control-group { margin-bottom: 10px; }
        .control-group label {
            display: flex;
            justify-content: space-between;
            font-size: 0.75em;
            margin-bottom: 4px;
            color: #b0bec5;
        }
        .control-group input[type="range"] {
            width: 100%;
            height: 5px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #ff7043;
            border-radius: 50%;
            cursor: pointer;
        }
        .control-group input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: #ff7043;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        .value-display { color: #ff7043; font-weight: bold; font-size: 0.9em; }
        .charge-list {
            max-height: 120px;
            overflow-y: auto;
            margin-top: 8px;
            padding-right: 4px;
        }
        .charge-list::-webkit-scrollbar {
            width: 4px;
        }
        .charge-list::-webkit-scrollbar-track {
            background: transparent;
        }
        .charge-list::-webkit-scrollbar-thumb {
            background: rgba(255,112,67,0.3);
            border-radius: 2px;
        }
        .charge-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            margin-bottom: 4px;
            font-size: 0.7em;
        }
        .charge-item .positive { color: #ef5350; }
        .charge-item .negative { color: #42a5f5; }
        .charge-item .delete-btn {
            background: none;
            border: none;
            color: #90a4ae;
            cursor: pointer;
            font-size: 1em;
        }
        .charge-item .delete-btn:hover { color: #fff; }
        .info-box {
            background: rgba(255, 112, 67, 0.1);
            border-left: 3px solid #ff7043;
            padding: 8px;
            border-radius: 0 8px 8px 0;
            font-size: 0.7em;
            line-height: 1.4;
            color: #b0bec5;
        }
        .formula { font-family: 'Times New Roman', serif; font-style: italic; color: #ff7043; }
        .legend {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 8px;
            font-size: 0.65em;
            flex-wrap: wrap;
        }
        .legend span { display: flex; align-items: center; gap: 4px; }
        .instruction {
            text-align: center;
            color: #90a4ae;
            font-size: 0.7em;
            margin-top: 6px;
        }
    </style>
</head>
<body>
    <h1>‚ö° Elektrisches Feld</h1>
    <p class="subtitle">Feldlinien und √Ñquipotentialfl√§chen</p>

    <div class="main-layout">
        <div class="canvas-container">
            <canvas id="fieldCanvas" width="1" height="1"></canvas>
            <p class="instruction">Klick: Ladungen platzieren | Zieh: Verschieben</p>
            <div class="legend">
                <span><span style="color:#ef5350;">‚óè</span> +</span>
                <span><span style="color:#42a5f5;">‚óè</span> ‚àí</span>
                <span><span style="color:#ffca28;">‚Üí</span> Feldlinien</span>
            </div>
        </div>

        <div class="sidebar">
                <div class="panel">
                    <h3>‚ûï‚ûñ Ladung hinzuf√ºgen</h3>
                    <div class="charge-buttons">
                        <button class="charge-btn positive active" id="btnPositive">+</button>
                        <button class="charge-btn negative" id="btnNegative">‚àí</button>
                    </div>
                    <div class="control-group">
                        <label>Ladungsst√§rke <span class="value-display" id="chargeVal">1.0</span></label>
                        <input type="range" id="chargeStrength" min="0.5" max="3" step="0.5" value="1">
                    </div>
                    <button class="btn btn-clear" onclick="clearCharges()">üóëÔ∏è Alle Ladungen entfernen</button>
                </div>

                <div class="panel">
                    <h3>üé® Darstellung</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showFieldLines" checked>
                        <label for="showFieldLines">Feldlinien</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showPotential">
                        <label for="showPotential">Potentialfl√§chen (Farbe)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="showVectors">
                        <label for="showVectors">Feldvektoren (Gitter)</label>
                    </div>
                    <div class="control-group">
                        <label>Feldlinien-Dichte <span class="value-display" id="densityVal">8</span></label>
                        <input type="range" id="lineDensity" min="4" max="16" value="8">
                    </div>
                </div>

                <div class="panel">
                    <h3>üìã Platzierte Ladungen</h3>
                    <div class="charge-list" id="chargeList">
                        <em style="color: #90a4ae; font-size: 0.85em;">Noch keine Ladungen platziert</em>
                    </div>
                </div>

                <div class="info-box">
                    <strong>Feldlinien:</strong> Zeigen die Richtung der Kraft auf eine positive Probeladung. Sie beginnen bei <span style="color:#ef5350;">+</span> und enden bei <span style="color:#42a5f5;">‚àí</span>.<br><br>
                    <span class="formula">E = k ¬∑ q / r¬≤</span>
                </div>
            </div>
        </div>

    <script>
        const canvas = document.getElementById('fieldCanvas');
        const ctx = canvas.getContext('2d');

        // Responsive canvas sizing
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth - 20;
            canvas.height = container.clientHeight - 50;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        const k = 50; // Coulomb constant (scaled)
        let charges = [];
        let selectedChargeType = 'positive';
        let chargeStrength = 1;
        let lineDensity = 8;
        let showFieldLines = true;
        let showPotential = false;
        let showVectors = false;
        let draggingCharge = null;

        // Preset configurations
        function addCharge(x, y, q) {
            charges.push({ x, y, q });
            updateChargeList();
            draw();
        }

        function clearCharges() {
            charges = [];
            updateChargeList();
            draw();
        }

        function updateChargeList() {
            const list = document.getElementById('chargeList');
            if (charges.length === 0) {
                list.innerHTML = '<em style="color: #90a4ae; font-size: 0.85em;">Noch keine Ladungen platziert</em>';
                return;
            }
            list.innerHTML = charges.map((c, i) => `
                <div class="charge-item">
                    <span class="${c.q > 0 ? 'positive' : 'negative'}">
                        ${c.q > 0 ? '+' : '‚àí'}${Math.abs(c.q).toFixed(1)} @ (${Math.round(c.x)}, ${Math.round(c.y)})
                    </span>
                    <button class="delete-btn" onclick="deleteCharge(${i})">√ó</button>
                </div>
            `).join('');
        }

        function deleteCharge(index) {
            charges.splice(index, 1);
            updateChargeList();
            draw();
        }

        function getElectricField(x, y) {
            let Ex = 0, Ey = 0;
            for (const charge of charges) {
                const dx = x - charge.x;
                const dy = y - charge.y;
                const r = Math.sqrt(dx * dx + dy * dy);
                if (r < 5) continue;
                const E = k * charge.q / (r * r);
                Ex += E * dx / r;
                Ey += E * dy / r;
            }
            return { Ex, Ey };
        }

        function getPotential(x, y) {
            let V = 0;
            for (const charge of charges) {
                const dx = x - charge.x;
                const dy = y - charge.y;
                const r = Math.sqrt(dx * dx + dy * dy);
                if (r < 5) r = 5;
                V += k * charge.q / r;
            }
            return V;
        }

        function drawPotentialField() {
            const imageData = ctx.createImageData(canvas.width, canvas.height);
            const data = imageData.data;

            let maxV = 0;
            for (let y = 0; y < canvas.height; y += 4) {
                for (let x = 0; x < canvas.width; x += 4) {
                    const V = Math.abs(getPotential(x, y));
                    if (V > maxV && V < 1000) maxV = V;
                }
            }

            for (let y = 0; y < canvas.height; y++) {
                for (let x = 0; x < canvas.width; x++) {
                    const V = getPotential(x, y);
                    const normalizedV = Math.max(-1, Math.min(1, V / (maxV || 1)));

                    let r, g, b;
                    if (normalizedV > 0) {
                        r = Math.floor(100 + normalizedV * 155);
                        g = Math.floor(50 - normalizedV * 50);
                        b = Math.floor(50 - normalizedV * 50);
                    } else {
                        r = Math.floor(50 + normalizedV * 50);
                        g = Math.floor(50 + normalizedV * 50);
                        b = Math.floor(100 - normalizedV * 155);
                    }

                    const idx = (y * canvas.width + x) * 4;
                    data[idx] = r;
                    data[idx + 1] = g;
                    data[idx + 2] = b;
                    data[idx + 3] = 100;
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }

        function drawFieldLine(startX, startY, direction) {
            const steps = 300;
            const stepSize = 3;

            ctx.beginPath();
            ctx.moveTo(startX, startY);

            let x = startX, y = startY;

            for (let i = 0; i < steps; i++) {
                const { Ex, Ey } = getElectricField(x, y);
                const magnitude = Math.sqrt(Ex * Ex + Ey * Ey);
                if (magnitude < 0.1) break;

                const dx = direction * stepSize * Ex / magnitude;
                const dy = direction * stepSize * Ey / magnitude;

                x += dx;
                y += dy;

                if (x < 0 || x > canvas.width || y < 0 || y > canvas.height) break;

                // Check if we're too close to a charge
                let tooClose = false;
                for (const charge of charges) {
                    const dist = Math.sqrt((x - charge.x) ** 2 + (y - charge.y) ** 2);
                    if (dist < 15) {
                        tooClose = true;
                        break;
                    }
                }
                if (tooClose) break;

                ctx.lineTo(x, y);
            }

            ctx.strokeStyle = 'rgba(255, 202, 40, 0.6)';
            ctx.lineWidth = 1.5;
            ctx.stroke();
        }

        function drawFieldLines() {
            for (const charge of charges) {
                if (charge.q > 0) {
                    // Draw lines starting from positive charges
                    const numLines = Math.round(lineDensity * Math.abs(charge.q));
                    for (let i = 0; i < numLines; i++) {
                        const angle = (2 * Math.PI * i) / numLines;
                        const startX = charge.x + 18 * Math.cos(angle);
                        const startY = charge.y + 18 * Math.sin(angle);
                        drawFieldLine(startX, startY, 1);
                    }
                }
            }

            // If only negative charges, draw lines going into them
            const hasPositive = charges.some(c => c.q > 0);
            if (!hasPositive) {
                for (const charge of charges) {
                    if (charge.q < 0) {
                        const numLines = Math.round(lineDensity * Math.abs(charge.q));
                        for (let i = 0; i < numLines; i++) {
                            const angle = (2 * Math.PI * i) / numLines;
                            const startX = charge.x + 18 * Math.cos(angle);
                            const startY = charge.y + 18 * Math.sin(angle);
                            drawFieldLine(startX, startY, -1);
                        }
                    }
                }
            }
        }

        function drawVectorField() {
            const gridSize = 40;
            const arrowScale = 0.8;

            for (let x = gridSize; x < canvas.width; x += gridSize) {
                for (let y = gridSize; y < canvas.height; y += gridSize) {
                    const { Ex, Ey } = getElectricField(x, y);
                    const magnitude = Math.sqrt(Ex * Ex + Ey * Ey);
                    if (magnitude < 0.5) continue;

                    const length = Math.min(15, magnitude * arrowScale);
                    const angle = Math.atan2(Ey, Ex);

                    const endX = x + length * Math.cos(angle);
                    const endY = y + length * Math.sin(angle);

                    ctx.strokeStyle = `rgba(255, 202, 40, ${Math.min(0.8, magnitude * 0.1)})`;
                    ctx.lineWidth = 1.5;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();

                    // Arrow head
                    const headLen = 4;
                    ctx.beginPath();
                    ctx.moveTo(endX, endY);
                    ctx.lineTo(endX - headLen * Math.cos(angle - 0.5), endY - headLen * Math.sin(angle - 0.5));
                    ctx.moveTo(endX, endY);
                    ctx.lineTo(endX - headLen * Math.cos(angle + 0.5), endY - headLen * Math.sin(angle + 0.5));
                    ctx.stroke();
                }
            }
        }

        function drawCharges() {
            for (const charge of charges) {
                // Glow
                const gradient = ctx.createRadialGradient(charge.x, charge.y, 0, charge.x, charge.y, 35);
                if (charge.q > 0) {
                    gradient.addColorStop(0, 'rgba(239, 83, 80, 0.5)');
                    gradient.addColorStop(1, 'rgba(239, 83, 80, 0)');
                } else {
                    gradient.addColorStop(0, 'rgba(66, 165, 245, 0.5)');
                    gradient.addColorStop(1, 'rgba(66, 165, 245, 0)');
                }
                ctx.beginPath();
                ctx.arc(charge.x, charge.y, 35, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();

                // Charge body
                const size = 12 + Math.abs(charge.q) * 4;
                ctx.beginPath();
                ctx.arc(charge.x, charge.y, size, 0, Math.PI * 2);
                ctx.fillStyle = charge.q > 0 ? '#ef5350' : '#42a5f5';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Sign
                ctx.fillStyle = '#fff';
                ctx.font = `bold ${size}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(charge.q > 0 ? '+' : '‚àí', charge.x, charge.y);
            }
        }

        function draw() {
            ctx.fillStyle = '#0a0a15';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (charges.length === 0) {
                ctx.fillStyle = '#90a4ae';
                ctx.font = '16px Segoe UI';
                ctx.textAlign = 'center';
                ctx.fillText('Klicke, um Ladungen zu platzieren', canvas.width / 2, canvas.height / 2);
                return;
            }

            if (showPotential) drawPotentialField();
            if (showVectors) drawVectorField();
            if (showFieldLines) drawFieldLines();
            drawCharges();
        }

        // Event listeners
        document.getElementById('btnPositive').addEventListener('click', () => {
            selectedChargeType = 'positive';
            document.getElementById('btnPositive').classList.add('active');
            document.getElementById('btnNegative').classList.remove('active');
        });

        document.getElementById('btnNegative').addEventListener('click', () => {
            selectedChargeType = 'negative';
            document.getElementById('btnNegative').classList.add('active');
            document.getElementById('btnPositive').classList.remove('active');
        });

        document.getElementById('chargeStrength').addEventListener('input', (e) => {
            chargeStrength = parseFloat(e.target.value);
            document.getElementById('chargeVal').textContent = chargeStrength.toFixed(1);
        });

        document.getElementById('lineDensity').addEventListener('input', (e) => {
            lineDensity = parseInt(e.target.value);
            document.getElementById('densityVal').textContent = lineDensity;
            draw();
        });

        document.getElementById('showFieldLines').addEventListener('change', (e) => {
            showFieldLines = e.target.checked;
            draw();
        });

        document.getElementById('showPotential').addEventListener('change', (e) => {
            showPotential = e.target.checked;
            draw();
        });

        document.getElementById('showVectors').addEventListener('change', (e) => {
            showVectors = e.target.checked;
            draw();
        });

        // Canvas interaction
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Check if clicking on existing charge
            for (const charge of charges) {
                const dist = Math.sqrt((x - charge.x) ** 2 + (y - charge.y) ** 2);
                if (dist < 20) {
                    draggingCharge = charge;
                    return;
                }
            }

            // Add new charge
            const q = selectedChargeType === 'positive' ? chargeStrength : -chargeStrength;
            addCharge(x, y, q);
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!draggingCharge) return;
            const rect = canvas.getBoundingClientRect();
            draggingCharge.x = e.clientX - rect.left;
            draggingCharge.y = e.clientY - rect.top;
            updateChargeList();
            draw();
        });

        canvas.addEventListener('mouseup', () => { draggingCharge = null; });
        canvas.addEventListener('mouseleave', () => { draggingCharge = null; });

        // Initial example
        addCharge(canvas.width / 2 - 100, canvas.height / 2, 1.5);
        addCharge(canvas.width / 2 + 100, canvas.height / 2, -1.5);
    </script>
</body>
</html>
